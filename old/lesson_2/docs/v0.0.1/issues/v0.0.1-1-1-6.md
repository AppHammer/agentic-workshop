# Title: v0.0.1-1-1-6 - Error Handling and Loading States

## Summary: 
Implement comprehensive error handling and loading state management in the Profile component to provide appropriate user feedback during data fetching, network errors, authentication failures, and other error conditions.

### Acceptance Criteria:
- [ ] Loading state displays immediately when component mounts
- [ ] Loading indicator is visually centered and clear
- [ ] Loading state doesn't flash for very fast responses (consider minimum display time)
- [ ] Error messages are user-friendly (no raw error stack traces)
- [ ] Error handling differentiates between network errors and authorization errors
- [ ] 401 Unauthorized responses trigger redirect to login via AuthContext
- [ ] Network errors show "Unable to load profile. Please try again."
- [ ] Retry button provided for network errors
- [ ] Retry button clears error state and re-attempts API call
- [ ] Error messages use consistent styling from existing error patterns
- [ ] Console logs detailed errors for debugging (not shown to user)
- [ ] Handles edge case of no profile data returned
- [ ] Loading and error states tested manually

### Test Strategy:

**Types of Tests:**
- Manual testing with simulated errors
- Network condition testing
- Edge case testing

**Test Cases:**
1. **Normal Loading**: Verify smooth loading state display and dismissal
2. **Network Error**: Disconnect network, verify error message and retry button
3. **401 Unauthorized**: Use expired/invalid token, verify redirect to login
4. **500 Server Error**: Simulate backend error, verify user-friendly message
5. **Retry Functionality**: Click retry button, verify it clears error and refetches
6. **Empty Response**: Mock empty/null response, verify appropriate handling
7. **Slow Network**: Test with throttled network, verify loading state persists
8. **Fast Response**: Verify no loading state flash on very fast responses
9. **Console Logging**: Verify errors are logged to console for debugging

**Tools:**
- Chrome DevTools Network tab (throttling, offline mode)
- Manual token manipulation
- Console logging verification
- Backend server shutdown for testing

---

## üìù Code Changes

**Description:**
The error handling and loading states are already implemented in the Profile.jsx component (v0.0.1-1-1-3). This issue focuses on validating the implementation, testing edge cases, and making refinements based on real-world testing. May need to add integration with AuthContext for proper logout on 401 errors.

**File:** `frontend/src/pages/Profile.jsx` (validation and potential enhancements)

Current implementation to validate:
```jsx
const [profile, setProfile] = useState(null);
const [loading, setLoading] = useState(true);
const [error, setError] = useState(null);

const fetchProfile = async () => {
  try {
    setLoading(true);
    const response = await profileAPI.getMyProfile();
    setProfile(response.data);
    setError(null);
  } catch (err) {
    console.error('Error fetching profile:', err);
    setError(err.response?.data?.detail || 'Failed to load profile');
  } finally {
    setLoading(false);
  }
};
```

**Potential Enhancement: Handle 401 with logout**

```diff
  import { useState, useEffect } from 'react';
+ import { useNavigate } from 'react-router-dom';
+ import { useAuth } from '../AuthContext';
  import { profileAPI } from '../api';
  import '../App.css';

  export default function Profile() {
    const [profile, setProfile] = useState(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);
+   const navigate = useNavigate();
+   const { logout } = useAuth();

    useEffect(() => {
      fetchProfile();
    }, []);

    const fetchProfile = async () => {
      try {
        setLoading(true);
        const response = await profileAPI.getMyProfile();
        setProfile(response.data);
        setError(null);
      } catch (err) {
        console.error('Error fetching profile:', err);
        
+       // Handle authentication errors
+       if (err.response?.status === 401) {
+         console.log('Authentication failed, logging out...');
+         logout();
+         navigate('/login', { 
+           state: { message: 'Your session has expired. Please login again.' }
+         });
+         return;
+       }
        
        setError(err.response?.data?.detail || 'Failed to load profile. Please try again.');
      } finally {
        setLoading(false);
      }
    };

    // ... rest of component
  }
```

**Potential Enhancement: Minimum loading time to prevent flash**

```diff
  const fetchProfile = async () => {
+   const startTime = Date.now();
    
    try {
      setLoading(true);
      const response = await profileAPI.getMyProfile();
      setProfile(response.data);
      setError(null);
    } catch (err) {
      console.error('Error fetching profile:', err);
      
      if (err.response?.status === 401) {
        logout();
        navigate('/login', { 
          state: { message: 'Your session has expired. Please login again.' }
        });
        return;
      }
      
      setError(err.response?.data?.detail || 'Failed to load profile. Please try again.');
    } finally {
+     // Ensure minimum loading time to prevent flash
+     const elapsedTime = Date.now() - startTime;
+     const minimumLoadTime = 300; // milliseconds
+     
+     if (elapsedTime < minimumLoadTime) {
+       setTimeout(() => setLoading(false), minimumLoadTime - elapsedTime);
+     } else {
+       setLoading(false);
+     }
    }
  };
```

**Enhanced Error Display:**

```jsx
if (error) {
  return (
    <div className="container">
      <div className="error-container">
        <div className="error-icon">‚ö†Ô∏è</div>
        <h2 className="error-title">Unable to Load Profile</h2>
        <p className="error-message">{error}</p>
        <button onClick={fetchProfile} className="retry-button">
          Try Again
        </button>
        <button 
          onClick={() => navigate('/dashboard')} 
          className="secondary-button"
          style={{ marginLeft: '1rem' }}
        >
          Back to Dashboard
        </button>
      </div>
    </div>
  );
}
```

---

## üñ•Ô∏è Front End Components (If Applicable)

**Component Name:** `Profile.jsx` (error handling validation)

**Description:**
Validate and enhance error handling in the Profile component to ensure all error scenarios are handled gracefully with appropriate user feedback and recovery options.

**Enhanced CSS for Error States:**

```css
/* Enhanced error display */
.error-container {
  text-align: center;
  padding: 3rem 2rem;
  max-width: 500px;
  margin: 2rem auto;
  background-color: #fff3cd;
  border: 2px solid #ffc107;
  border-radius: 12px;
}

.error-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
}

.error-title {
  color: #856404;
  margin-bottom: 0.5rem;
  font-size: 1.5rem;
}

.error-message {
  color: #856404;
  margin-bottom: 2rem;
  font-size: 1rem;
  line-height: 1.5;
}

.secondary-button {
  padding: 0.5rem 1.5rem;
  background-color: #6c757d;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
}

.secondary-button:hover {
  background-color: #5a6268;
}

/* Loading state animations */
.loading-message {
  text-align: center;
  padding: 3rem;
  font-size: 1.1rem;
  color: #666;
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

/* Loading spinner option */
.loading-spinner {
  border: 4px solid #f3f3f3;
  border-top: 4px solid #0066cc;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 3rem auto;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
```

**Error Scenarios to Test:**

1. **Network Offline:**
```javascript
// Expected behavior: Show "Failed to load profile" with retry button
// Network error in console, user-friendly message on screen
```

2. **401 Unauthorized:**
```javascript
// Expected behavior: Automatic logout and redirect to login
// Message: "Your session has expired. Please login again."
```

3. **500 Server Error:**
```javascript
// Expected behavior: Show error with retry option
// Console logs full error, user sees generic message
```

4. **Timeout:**
```javascript
// Expected behavior: Same as network error
// User can retry to attempt again
```

---

## üì¶ Dependencies (If Applicable)

No new dependencies required. May need to use existing:

**Package Manager:** `npm`
- `react-router-dom@^6.20.0` (for useNavigate if adding logout redirect)
- `react@^18.2.0` (already installed)

---

## Issue Dependencies

- **Depends on:** v0.0.1-1-1-3 - Create Profile Page Component (component must exist)
- **Depends on:** v0.0.1-1-1-4 - Add Profile Route and Integration (must be able to test the page)

## Related Issues

- v0.0.1-1-1-1 - Backend API Endpoint for User Profile (source of potential errors)
- v0.0.1-1-1-3 - Create Profile Page Component (where error handling is implemented)
- v0.0.1-1-1-5 - Conditional Tasker Fields Display (complementary UX concerns)