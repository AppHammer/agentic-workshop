# Title: v0.0.1-1-1-1 - Backend API Endpoint for User Profile

## Summary: 
Create a secure FastAPI endpoint at `/api/users/me/profile` that returns complete user profile data including username, email, user type, creation date, and tasker-specific fields (skills and hourly rate) for authenticated users.

### Acceptance Criteria:
- [ ] Endpoint path is `/api/users/me/profile` using GET method
- [ ] Authentication required via JWT token in Authorization header
- [ ] Response includes: id, username, email, user_type, created_at
- [ ] For taskers, response also includes: skills, hourly_rate
- [ ] Unauthorized requests return 401 status
- [ ] Endpoint uses dependency injection for database session
- [ ] Database errors handled gracefully with appropriate HTTP status codes
- [ ] Response time is under 200ms (excluding network latency)
- [ ] Endpoint documented in FastAPI's automatic OpenAPI/Swagger docs
- [ ] Unit tests written covering success, authentication failure, and user not found scenarios
- [ ] Test coverage >90% for the new endpoint code

### Test Strategy:

**Types of Tests:**
- Unit tests using pytest
- Integration tests with database
- Authentication tests

**Test Cases:**
1. **Success Case**: Valid JWT token returns complete profile data
2. **Authentication Failure**: Invalid/missing token returns 401
3. **User Not Found**: Valid token but user deleted returns 404
4. **Tasker Profile**: Verify tasker-specific fields are included for tasker users
5. **Customer Profile**: Verify tasker-specific fields are null/excluded for customer users
6. **Database Error**: Simulate database error and verify 500 response

**Tools:**
- pytest for test execution
- pytest-asyncio for async test support
- pytest-cov for coverage reporting

---

## üìù Code Changes

**Description:**
Add a new GET endpoint `/users/me/profile` in [`main.py`](backend/main.py:1) that retrieves the authenticated user's complete profile information. The endpoint will reuse the existing `get_current_user` dependency from [`auth.py`](backend/auth.py:34) for authentication and return data formatted using a new Pydantic schema.

**File:** `backend/main.py`
```diff
+ @app.get("/users/me/profile", response_model=schemas.UserProfile)
+ def get_user_profile(current_user: models.User = Depends(get_current_user)):
+     """
+     Get the complete profile of the currently authenticated user.
+     
+     Returns:
+         UserProfile: Complete user profile including tasker-specific fields if applicable
+     
+     Raises:
+         HTTPException: 401 if authentication fails
+     """
+     return current_user
```

**File:** `backend/schemas.py`
```diff
+ class UserProfile(BaseModel):
+     """Complete user profile schema with all fields"""
+     id: int
+     username: str
+     email: EmailStr
+     user_type: UserType
+     created_at: datetime
+     skills: Optional[str] = None
+     hourly_rate: Optional[float] = None
+     
+     class Config:
+         from_attributes = True
```

---

## ‚ú® New Files (If Applicable)

- `backend/test_profile.py` - Unit tests for the profile endpoint

---

## üìÑ JSON Contracts (If Applicable)

**Contract Name:** `UserProfile Response`

```json
{
  "id": 1,
  "username": "johndoe",
  "email": "john@example.com",
  "user_type": "tasker",
  "created_at": "2024-01-15T10:30:00Z",
  "skills": "Plumbing, Electrical Work",
  "hourly_rate": 45.00
}
```

**Customer Response Example:**
```json
{
  "id": 2,
  "username": "janedoe",
  "email": "jane@example.com",
  "user_type": "customer",
  "created_at": "2024-01-20T14:22:00Z",
  "skills": null,
  "hourly_rate": null
}
```

---

## üì° API Specs (If Applicable)

```yaml
openapi: 3.0.0
info:
  title: Tasker Marketplace API
  version: 1.0.0
paths:
  /users/me/profile:
    get:
      summary: Get current user's profile
      description: Returns complete profile information for the authenticated user including tasker-specific fields
      security:
        - BearerAuth: []
      responses:
        '200':
          description: User profile data
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 1
                  username:
                    type: string
                    example: johndoe
                  email:
                    type: string
                    format: email
                    example: john@example.com
                  user_type:
                    type: string
                    enum: [customer, tasker]
                    example: tasker
                  created_at:
                    type: string
                    format: date-time
                    example: "2024-01-15T10:30:00Z"
                  skills:
                    type: string
                    nullable: true
                    example: "Plumbing, Electrical Work"
                  hourly_rate:
                    type: number
                    format: float
                    nullable: true
                    example: 45.00
        '401':
          description: Unauthorized - Invalid or missing authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  detail:
                    type: string
                    example: "Could not validate credentials"
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
```

---

## üì¶ Dependencies (If Applicable)

No new dependencies required. Uses existing:

**Package Manager:** `pip`
- `fastapi==0.104.1` (already installed)
- `sqlalchemy==2.0.23` (already installed)
- `pydantic==2.5.0` (already installed)
- `pytest==7.4.3` (already installed for testing)

---

## Issue Dependencies

None - This is the first task in the epic and has no dependencies.

## Related Issues

- v0.0.1-1-1-2 - Make Navigation Username Clickable (will use this endpoint)
- v0.0.1-1-1-3 - Create Profile Page Component (will consume this endpoint)
- v0.0.1-1-1-4 - Add Profile Route and Integration (will integrate with this endpoint)