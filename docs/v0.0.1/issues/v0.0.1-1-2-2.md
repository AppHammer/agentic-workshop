# Title: v0.0.1-1-2-2 - Enhance Message Response with Task Details

## Summary: 
Enhance the message response schema and GET /messages endpoint to include task details (title, status) when task_id is present, providing rich context in the UI.

### Acceptance Criteria:
- [ ] Enhanced MessageResponseWithTask schema created with task_title and task_status fields
- [ ] GET /messages endpoint returns task details via SQLAlchemy relationship JOIN
- [ ] Task details included only when task_id is not null
- [ ] Database query optimized with proper JOINs (no N+1 queries)
- [ ] Response time does not increase by more than 50ms
- [ ] Integration tests verify task details in response
- [ ] Backwards compatible with existing message responses

### Test Strategy:

**Integration Tests (pytest):**
- Test message response includes task details when task_id present
- Test message response without task details when task_id is null
- Test query performance with 100+ messages
- Test JOIN query correctness
- Test response schema validation

**Tools:** pytest, pytest-asyncio, FastAPI TestClient, pytest-benchmark
**Coverage Target:** >85%

---

## ğŸ“ Code Changes

**Description:**
Create an enhanced response schema that includes task information and modify the GET /messages endpoint to use efficient JOINs to fetch task details.

**File:** `app/backend/schemas.py`

```diff
+ from typing import Optional
+ from database import TaskStatus
  
  class MessageResponse(BaseModel):
      id: int
      sender_id: int
      receiver_id: int
      task_id: Optional[int] = None
      content: str
      read: bool
      created_at: datetime
      
      class Config:
          from_attributes = True

+ class MessageResponseWithTask(MessageResponse):
+     """Enhanced message response including task context"""
+     task_title: Optional[str] = None
+     task_status: Optional[TaskStatus] = None
+     
+     class Config:
+         from_attributes = True
```

**File:** `app/backend/main.py`

```diff
- @app.get("/messages", response_model=List[schemas.MessageResponse])
+ @app.get("/messages", response_model=List[schemas.MessageResponseWithTask])
  async def get_messages(
      current_user: User = Depends(get_current_user),
      db: Session = Depends(get_db)
  ):
-     messages = db.query(Message).filter(
+     messages = db.query(
+         Message.id,
+         Message.sender_id,
+         Message.receiver_id,
+         Message.task_id,
+         Message.content,
+         Message.read,
+         Message.created_at,
+         Task.title.label('task_title'),
+         Task.status.label('task_status')
+     ).outerjoin(
+         Task, Message.task_id == Task.id
+     ).filter(
          or_(
              Message.sender_id == current_user.id,
              Message.receiver_id == current_user.id
          )
      ).order_by(Message.created_at.desc()).all()
      
      return messages
```

---

## ğŸ“¡ API Specs (If Applicable)

```yaml
openapi: 3.0.0
paths:
  /messages:
    get:
      summary: Get all messages for current user with task context
      responses:
        '200':
          description: List of messages with task details
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    sender_id:
                      type: integer
                    receiver_id:
                      type: integer
                    task_id:
                      type: integer
                      nullable: true
                    task_title:
                      type: string
                      nullable: true
                    task_status:
                      type: string
                      nullable: true
                    content:
                      type: string
                    read:
                      type: boolean
                    created_at:
                      type: string
                      format: date-time
```

---

## Issue Dependencies

**Depends on:**
- v0.0.1-1-2-1 - Add Task Context to Message Creation

**Blocks:**
- v0.0.1-2-1-1 - Enhanced Message List Frontend
- v0.0.1-2-4-1 - Task-Filtered Message View

## Related Issues

- v0.0.1-1-2-1 - Add Task Context to Message Creation
- v0.0.1-2-1-1 - Enhanced Message List with User Details (Frontend)